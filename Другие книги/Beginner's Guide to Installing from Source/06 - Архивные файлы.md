**Архив — это один файл, который содержит в себе ряд других файлов.** Существует несколько различных инструментов для создания таких файлов, но во всех случаях процесс по сути заключается в присоединении всех отдельных файлов друг к другу, а затем добавлении «**индекса**», который содержит смещение, длину, имя и другие свойства исходных файлов, чтобы их можно было извлечь снова.

> *Примечание: слово «архив» в английском языке может подразумевать что-то «старое», более не используемое, или «резервную» копию. Хотя архивные файлы могут использоваться для хранения резервных копий или редко используемых данных, они также удобны для передачи данных по сети.*

**Приложение «tar» упаковывает несколько файлов в один архивный файл формата «tar»,** который является наиболее часто используемым форматом в открытом исходном коде. Tar изначально означало «**tape archive**», но формат хорошо работает и на дисках. Архивы `tar` запоминают не только исходные имена файлов, но и их исходный Unix «идентификатор владельца» и права доступа к файлам. Идентификатор владельца редко полезен (если только tar-архив не был создан на той же машине, на которой он распаковывается), **но права доступа к файлам — полезны.** По соглашению, файлы формата `tar` обычно получают имена, оканчивающиеся на «`.tar`». Файлы формата `tar`, содержащие исходный код, иногда называют «`tarballs`».

**Приложение tar не сжимает содержимое файлов.** Однако файлы исходного кода очень хорошо сжимаются, а пропускная способность сети всегда слишком медленная и дорогая, поэтому `tar`-файлы обычно сжимаются после создания с использованием универсального приложения сжатия. **Наиболее часто используемый тип сжатия — «`gzip`»**, и результирующий файл обычно получает суффикс «`.tar.gz`» или «`.tgz`». Сжатие с помощью `bzip2` также распространено, и такие файлы обычно получают суффикс «`.tar.bz2`». Иногда используется сжатие «`xz`»; файлы обычно получают суффикс «`.tar.xz`».

[[tar просто архивирует исходный код (склеивает все части кода в одно) а вот gzip и bzip2 как раз сжимают код]]

Исходная версия приложения `tar` была создана давно, и она была перереализована несколько раз. К сожалению, это означает, **что доступные параметры командной строки значительно различаются в зависимости от того, какую версию приложения вы используете**. Функциональность также зависит от версии; в частности, некоторые версии могут автоматически определять, когда использовалось сжатие, и автоматически распаковывать, в то время как другие требуют передачи правильных параметров командной строки для обработки сжатых файлов, а третьи требуют сначала распаковки файла. Вот несколько примеров команд для извлечения файлов из `tar`-архива:

```bash
# Современные параметры GNU tar. Работает и для файлов, сжатых
# с помощью gzip и bzip2 тоже
tar --extract --file filename

# То же, что выше
tar -xf filename

# То же, что выше. Ведущий "-" необязателен
tar xf filename

# явно распаковать файл, сжатый gzip, затем
# передать несжатый результат напрямую в tar
gzip -cd filename.tgz | tar xf -

# то же, что выше, но для файлов, сжатых bzip2
bunzip2 -cd filename.tar.bz2 | tar xf -
```

Обратите внимание, что если опустить «f», tar просто зависает (ожидает ввода пользователя).

> ***Предупреждение:** распаковка `tar`-файла может перезаписать локальные файлы. По умолчанию файлы распаковываются в подкаталог текущего каталога, что должно быть безопасно, если ваш текущий каталог является подходящим. Однако не доверяйте инструкциям, которые используют следующие параметры; они могут пытаться обманом заставить вас изменить важные локальные файлы:*

```text
-C или --directory
-P или --absolute-names
--transform или --xform
```

Большинство `tar`-файлов создаются таким образом, что их распаковка создает один подкаталог внутри текущего каталога, и все остальные файлы помещаются в этот каталог; например, распаковка файла с именем «`foo-1.2.tar.gz`» создаст подкаталог с именем «`foo-1.2`» **с файлами внутри этого каталога.** К сожалению, не все, кто упаковывает исходный код для загрузки, следуют этому соглашению; иногда tar-файл раскрывает свое содержимое прямо в текущий каталог — что может создать большой беспорядок, если в этом каталоге уже есть файлы. Поэтому лучше проверить содержимое **tar-файла перед распаковкой с помощью следующей команды**:

```bash
# Современный GNU tar
tar --list --file filename

# То же, что выше
tar -tf filename

# То же, что выше. Ведущий "-" необязателен
tar tf filename

gzip -cd filename | tar tf -
bunzip -cd filename | tar tf -
```

**Иногда архивные файлы распространяются в «формате zip»**. Zip-архивы наиболее распространены в мире `DOS` и `Windows` или в отношении `Java`, но иногда встречаются и в других местах. Формат `Zip` работает как комбинация `tar` и `gzip` (он использует то же сжатие, что и `gzip`, но свой собственный вид внутренней «индексации»). **Zip-файлы не сохраняют исходный идентификатор владельца Unix или права доступа к файлам.** Содержимое такого файла может быть извлечено с помощью команды `unzip` (при условии, что она установлена локально).

**По возможности, архивные файлы должны распаковываться при входе в систему как обычный пользователь, а не как пользователь «root».** Это дополнительная мера безопасности для предотвращения любых непреднамеренных перезаписей файлов. Однако настройки владельца файла, записанные в tar-файле, сохраняются только тогда, когда пользователь, распаковывающий архив, является пользователем `root`. **Если они важны (что нечасто), то архив должен быть распакован «как root»**.


---
[[Навигация по книге Beginner's Guide to Installing from Source]]


### Зачем вам это нужно?

**Важные обновления по сравнению с предыдущим руководством:**

1. **Формат `xz`:** Появился новый, более эффективный метод сжатия.

2. **Универсальная команда tar:** `tar xf filename` работает для всех типов (`gzip`, `bzip2`, `xz`) в современных GNU `tar`.

3. **Безопасность:** Предупреждение об опасных опциях tar (`-C`, `-P`, `--transform`).

4. **Всегда проверяйте содержимое:** Команда `tar tf` перед распаковкой — лучшая практика.

**Для LFS:** Вы будете использовать все эти форматы (особенно `xz`). Книга LFS предполагает, что у вас современный GNU tar, который обрабатывает сжатие автоматически.