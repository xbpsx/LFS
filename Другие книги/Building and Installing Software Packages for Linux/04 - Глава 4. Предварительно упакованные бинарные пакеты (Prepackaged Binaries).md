## Что не так с rpm?

Ручная сборка и установка пакетов из исходного кода, по-видимому, является настолько пугающей задачей для некоторых пользователей Linux, что они обратились к популярным форматам пакетов rpm и deb или более новому формату Stampede slp. Хотя установка rpm обычно проходит так же гладко и быстро, как установка программного обеспечения в одной другой печально известной операционной системе, **следует обязательно учитывать недостатки самоустанавливающихся, предварительно упакованных бинарных пакетов.**

**Во-первых,** имейте в виду, что программные пакеты обычно сначала выпускаются в виде "тарболов", а предварительно упакованные бинарные пакеты появляются через дни, недели и даже месяцы. Текущий пакет rpm, как правило, отстает как минимум на несколько минорных версий от последнего "тарбола". Поэтому, если вы хотите идти в ногу с последними версиями программного обеспечения (bleeding edge), вы, возможно, не захотите ждать появления rpm или deb. Некоторые менее популярные пакеты могут никогда не быть упакованы в rpm.

[[Тарболы против пакетных менеджеров]]

**Во-вторых,** пакет в виде "тарбола" может быть более полным, иметь больше опций и лучше поддаваться настройке и изменениям. Бинарная версия rpm может не иметь некоторых функций полного выпуска. Исходные rpm (source rpm) содержат полный исходный код и эквивалентны соответствующим "тарболам", и они также должны быть собраны и установлены с использованием либо опции `rpm --recompile packagename.rpm`, либо `rpm --rebuild packagename.rpm`.

**В-третьих,** некоторые предварительно упакованные бинарные пакеты могут установиться неправильно, и даже если они установятся, они могут вылетать и создавать дамп памяти (core-dump). Они могут зависеть от других версий библиотек, чем те, что присутствуют в вашей системе, или они могут быть неправильно подготовлены или просто сломаны. В любом случае, устанавливая rpm или deb, вы по необходимости доверяете экспертизе людей, **которые упаковали его**.

[[За тебя упаковали из торбола в .deb или .rpm]]

Наконец, полезно иметь исходный код под рукой, чтобы иметь возможность возиться с ним и учиться на нем. Гораздо проще иметь исходный код в архиве, из которого вы собираете бинарные файлы, а не в отдельном исходном rpm.

Установка пакета rpm не обязательно является простым делом. Если есть конфликт зависимостей, установка rpm не удастся. Точно так же, если rpm требует другую версию библиотек, чем те, что присутствуют в вашей системе, установка может не работать, даже если вы создадите символические ссылки на отсутствующие библиотеки из имеющихся. Несмотря на их удобство, установки rpm часто терпят неудачу по тем же причинам, что и установки из "тарболов".

Вы должны устанавливать rpm и deb от имени root, чтобы иметь необходимые права на запись, и это открывает потенциально серьезную дыру в безопасности, так как вы можете по неосторожности повредить системные бинарные файлы и библиотеки или даже установить троянского коня, который может нанести ущерб вашей системе. Поэтому важно получать пакеты rpm и deb из "проверенного источника". В любом случае, перед установкой следует выполнить 'проверку подписи' (по контрольной сумме MD5) пакета: `rpm --checksig packagename.rpm`. Также настоятельно рекомендуется запускать `rpm -K --nopgp packagename.rpm`. Соответствующие команды для пакетов deb: `dpkg -I | --info packagename.deb` и `dpkg -e | --control packagename.deb`.

Пример:

```text
rpm --checksig gnucash-1.1.23-4.i386.rpm

gnucash-1.1.23-4.i386.rpm: size md5 OK

rpm -K --nopgp gnucash-1.1.23-4.i386.rpm

gnucash-1.1.23-4.i386.rpm: size md5 OK
```

Для по-настоящему параноидальных (и в этом случае есть много причин для паранойи) существуют утилиты `unrpm` и `rpmunpack`, доступные в каталоге Sunsite utils/package, для распаковки и проверки отдельных компонентов пакетов.

Klee Diene написал экспериментальный пакет `dpkgcert` для проверки целостности установленных файлов .deb с помощью контрольных сумм MD5. Он доступен в архиве Debian ftp. Текущее имя пакета / версия: `dpkgcert_0.2-4.1_all.deb`. Сайт Jim Pick Software поддерживает экспериментальную серверную базу данных для предоставления сертификатов dpkgcert для пакетов в типичной установке Debian.

В самом простом виде команды `rpm -i packagename.rpm` и `dpkg --install packagename.deb` автоматически распаковывают и устанавливают программное обеспечение. Однако будьте осторожны, поскольку слепое использование этих команд может быть опасным для здоровья вашей системы!

Обратите внимание, что вышеуказанные предупреждения также применимы, хотя и в меньшей степени, к утилите установки `pkgtool` от Slackware. Все "автоматические" установки программного обеспечения требуют осторожности.

Программы `martian` и `alien` позволяют конвертировать между форматами пакетов rpm, deb, Stampede slp и tar.gz. Это делает эти пакеты доступными для всех дистрибутивов Linux.

Внимательно прочитайте man-страницы для команд `rpm` и `dpkg` и обратитесь к RPM HOWTO, TFUG's Quick Guide to Red Hat's Package Manager и The Debian Package Management Tools для получения более подробной информации.

---
## Проблемы с rpm: пример

Ян Хубичка написал очень хороший пакет для фракталов под названием `xaos`. На его домашней странице доступны как .tar.gz, так и rpm пакеты. Ради удобства попробуем rpm-версию, а не "тарбол".

К сожалению, rpm для `xaos` не устанавливается. Две разные rpm-версии ведут себя плохо.

```text
rpm -i --test XaoS-3.0-1.i386.rpm

    error: failed dependencies:
            libslang.so.0 is needed by XaoS-3.0-1
            libpng.so.0 is needed by XaoS-3.0-1
            libaa.so.1 is needed by XaoS-3.0-1

rpm -i --test xaos-3.0-8.i386.rpm

    error: failed dependencies:
            libaa.so.1 is needed by xaos-3.0-8
```

Странно то, что [libslang.so](https://libslang.so).0, [libpng.so](https://libpng.so).0 и [libaa.so](https://libaa.so).1 все присутствуют в `/usr/lib `в тестируемой системе. Должно быть, rpm для `xaos` были собраны с немного другими версиями этих библиотек, даже если номера выпусков идентичны.

[[Проблема Rolling Release дистрибутивов]]

В качестве теста попробуем установить `xaos-3.0-8.i386.rpm` с опцией `--nodeps`, чтобы принудительно установить. Пробный запуск `xaos` вылетает.

```text
xaos: error in loading shared libraries: xaos: undefined symbol: __fabsl
```

Попробуем упрямо докопаться до сути. Запуск `ldd` на бинарном файле `xaos`, чтобы найти его зависимости от библиотек, показывает, что все необходимые разделяемые библиотеки присутствуют. Запуск `nm` на библиотеке /usr/lib/[libaa.so](https://libaa.so).1 для перечисления ее символических ссылок показывает, что ей действительно не хватает __fabsl. Конечно, отсутствующая ссылка может отсутствовать в одной из других библиотек... С этим ничего не поделать, кроме как заменить одну или несколько библиотек.

Хватит! Скачаем "тарбол" `XaoS-3.0.tar.gz`, доступный с ftp-сайта, а также с домашней страницы. Попробуем собрать его. Запуск `./configure`, `make` и, наконец (от имени root) `make install` проходит безупречно.

Это один из примеров того, что предварительно упакованные бинарные пакеты доставляют больше хлопот, чем они того стоят.

---
[[Навигация по книге «Building and Installing Software Packages for Linux»]]

### Зачем вам это нужно? Развёрнутые пояснения

Эта глава представляет собой **философское и практическое обоснование** того, почему вы проходите через трудности ручной сборки пакетов. Это критически важный мировоззренческий раздел перед началом LFS.

**1. Понимание полного цикла жизни ПО: от исходников до бинарников.**

- Автор объясняет естественный порядок: сначала появляются исходники ("тарболы"), и только потом, с задержкой, — бинарные пакеты (rpm/deb).

- **Для LFS:** Вы будете работать исключительно с исходниками. Вы становитесь тем, кто превращает исходный код в работающую систему, минуя промежуточные звенья (сборщиков пакетов). Это дает вам максимальную актуальность и контроль.

**2. "Bleeding Edge" (передний край) против стабильности.**

- rpm/deb пакеты обычно более старые, стабильные, протестированные. Исходники — самые свежие, со всеми новыми функциями и багфиксами.

- **Для LFS:** В книге LFS используются проверенные, стабильные версии пакетов. Но после завершения LFS вы сможете обновлять свою систему, собирая новые версии из исходников, получив таким образом полный контроль над версиями.

**3. Полнота и возможность кастомизации.**

- Бинарные пакеты часто собираются с минимальным набором функций, чтобы уменьшить размер и зависимости.

- Исходники позволяют включить все возможности, настроить под свои нужды через опции `configure`.

- **Для LFS:** Вы будете использовать стандартные опции `configure` из книги LFS, но понимание этого принципа важно для будущей самостоятельной настройки системы.

**4. Проблема зависимостей (dependency hell).**

- Автор показывает классическую проблему: библиотечные зависимости. Бинарный пакет требует _точную_ версию библиотеки, которая может не совпадать с установленной у вас.

- **Для LFS:** Вы избежите этой проблемы, потому что будете собирать _полностью согласованную_ систему. Все пакеты будут собраны с одними и теми же библиотеками, в правильном порядке. Это одна из главных целей LFS — создать гармоничную систему без конфликтов зависимостей.

**5. Безопасность и доверие.**

- Установка бинарных пакетов от root — это риск. Вы доверяете не только автору программы, но и сборщику пакета.

- С исходниками вы доверяете только автору (и можете проверить код).

- **Для LFS:** Вы будете собирать всё из исходников, проверенных сообществом. Это максимально прозрачный подход.

**6. Инструменты для работы с пакетами (rpm, dpkg).**

- Знакомство с этими инструментами полезно, даже если вы их не используете. Вы поймете, как устроены системы управления пакетами, которые вы, возможно, будете использовать после LFS.

**7. Практический пример с XaoS — учебный случай.**

- Это не просто пример, а **методология отладки**:

    1. Проверка зависимостей (`rpm -i --test`, `ldd`)
    
    2. Анализ символов в библиотеках (`nm`)
    
    3. Осознание, что проблема в несовместимости версий библиотек
    
    4. Решение — сборка из исходников

- **Для LFS:** Вы научитесь таким методам отладки. В процессе сборки LFS что-то может пойти не так, и вам нужно будет уметь анализировать ошибки.

**Почему эта глава критически важна перед LFS:**  
LFS — это _антитеза_ бинарным пакетам. Если вы не понимаете недостатков rpm/deb, вы не поймете философскую мотивацию LFS. Автор готовит ваше мышление:

- Вы не просто "ставите программы", а _создаете систему_.

- Вы берете на себя ответственность, которую обычно несут сборщики дистрибутивов.

- Вы получаете систему, идеально соответствующую вашему железу и потребностям.

**Практический совет перед LFS:**

1. Попробуйте установить какой-нибудь пакет из rpm/deb, затем удалите его и установите из исходников. Сравните процесс.

2. Изучите структуру rpm-пакета: `rpm -qpl package.rpm` (список файлов), `rpm -qp --scripts package.rpm` (скрипты, которые выполняются при установке).

3. Соберите простой пакет из исходников с разными опциями `configure` и сравните результат.

**Итог главы:** Это манифест независимости. Автор показывает, что reliance (зависимость) от бинарных пакетов делает вас уязвимым к проблемам с зависимостями, задержкам обновлений и ограничивает контроль. Сборка из исходников — это путь к пониманию, контролю и настоящей экспертизе. Именно эта философия лежит в основе LFS: понять систему настолько глубоко, чтобы быть able (способным) создать её с нуля.