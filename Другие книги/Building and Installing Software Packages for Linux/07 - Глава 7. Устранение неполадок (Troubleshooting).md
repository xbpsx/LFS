Если `xmkmf` и/или `make` завершились без ошибок, вы можете перейти к следующему разделу. Однако в "реальной жизни" мало что работает правильно с первого раза. Это тот момент, когда ваша изобретательность подвергается испытанию.

## 7.1 Ошибки компоновки (Link Errors)

- Предположим, что `make` завершается с ошибкой компоновки: `-lX11: No such file or directory`, даже после того, как был вызван `xmkmf`. Это может означать, что файл `Imake` был настроен неправильно. Проверьте первую часть `Makefile` на наличие строк, таких как:

```text
LIB=            -L/usr/X11/lib
INCLUDE=        -I/usr/X11/include/X11
LIBS=           -lX11 -lc -lm
```

Ключи `-L` и `-I` указывают компилятору и компоновщику, где искать файлы библиотек и заголовочные файлы соответственно. В этом примере библиотеки X11 должны находиться в каталоге `/usr/X11/lib`, а заголовочные файлы X11 — в каталоге `/usr/X11/include/X11`. Если для вашей машины это неверно, внесите необходимые изменения в `Makefile` и попробуйте запустить `make` снова.

- Неопределенные ссылки на функции математической библиотеки, например:

```text
/tmp/cca011551.o(.text+0x11): undefined reference to `cos'
```

Исправление заключается в явном подключении математической библиотеки, добавив `-lm` к флагам `LIB` или `LIBS` в `Makefile` (см. предыдущий пример).

- Еще одна вещь, которую можно попробовать, если `xmkmf` не сработал, — это следующий скрипт:

```text
make -DUseInstalled -I/usr/X386/lib/X11/config
```

Это своего рода эквивалент `xmkmf` в минимальной конфигурации.

В очень редких случаях запуск `ldconfig` от имени `root` может быть решением:

```text
# ldconfig
```

`ldconfig` обновляет символические ссылки для разделяемых библиотек. Это может быть необязательно.

- Некоторые `Makefile` используют неузнаваемые псевдонимы для библиотек, присутствующих в вашей системе. Например, сборка может требовать `libX11.so.6`, но в `/usr/X11R6/lib` нет такого файла или ссылки. Однако есть `libX11.so.6.1`. Решение — выполнить `ln -s /usr/X11R6/lib/libX11.so.6.1 /usr/X11R6/lib/libX11.so.6` от имени root. После этого может потребоваться запустить `ldconfig`.

- Иногда для сборки исходников требуются библиотеки старого релиза X11R5. Если у вас есть библиотеки R5 в `/usr/X11R6/lib` (вам предоставили возможность их установки при первой установке Linux), то вам нужно только убедиться, что у вас есть необходимые ссылки для сборки программного обеспечения. Библиотеки R5 называются `libX11.so.3.1.0`, `libXaw.so.3.1.0` и `libXt.so.3.1.0`. Обычно нужны ссылки, такие как `libX11.so.3 -> libX11.so.3.1.0`. Возможно, программному обеспечению также потребуется ссылка вида `libX11.so -> libX11.so.3.1.0`. Конечно, чтобы создать "отсутствующую" ссылку, используйте команду `ln -s libX11.so.3.1.0 libX11.so` от имени root.

- Некоторые пакеты потребуют установки обновленных версий одной или нескольких библиотек. Например, версии 4.x пакета StarOffice от StarDivision GmbH печально известны тем, что требуют версию` libc 5.4.4 `или выше. Даже более поздний StarOffice 5.0 не будет работать после установки с новыми библиотеками `glibc 2.1`. К счастью, новый StarOffice 5.1 решает эти проблемы. Если вы запускаете старую версию StarOffice, вам нужно, будучи `root`, скопировать одну или несколько библиотек в соответствующие каталоги, удалить старые библиотеки, а затем восстановить символические ссылки (подробнее об этом см. в последней версии мини-HOWTO по StarOffice)*. Внимание: будьте крайне осторожны, так как вы можете сделать систему неработоспособной, если допустите ошибку. Последние обновленные библиотеки обычно можно найти на Sunsite.*

## 7.2 Другие проблемы

- Установленный скрипт на `Perl` или `shell` выдает сообщение об ошибке `No such file or directory`. В этом случае проверьте права доступа к файлу, чтобы убедиться, что он исполняемый, и проверьте заголовок файла, чтобы убедиться, что оболочка или программа, вызываемая скриптом, находится в указанном месте. Например, скрипт может начинаться с:

```text
#!/usr/local/bin/perl
```

Если Perl фактически установлен в вашем каталоге `/usr/bin`, а не в `/usr/local/bin`, то скрипт не запустится. Есть два способа исправить это. Заголовок файла скрипта может быть изменен на `#!/usr/bin/perl`, или может быть добавлена символическая ссылка на правильный каталог: `ln -s /usr/bin/perl /usr/local/bin/perl`.

- Некоторое программное обеспечение для X11 требует библиотеки Motif для сборки. Стандартные дистрибутивы Linux не имеют установленных библиотек Motif, и в настоящее время Motif стоит дополнительные $100-$200 (хотя бесплатный Lesstif также работает во многих случаях). Если вам нужен Motif для сборки определенного пакета, но у вас нет библиотек Motif, возможно, удастся получить статически скомпонованные бинарники. Статическая компоновка включает библиотечные подпрограммы в сами бинарные файлы. Это приводит к увеличению размера бинарных файлов, но код будет работать в системах, где отсутствуют библиотеки.

- Когда пакет требует для сборки библиотеки, отсутствующие в вашей системе, это приведет к ошибкам компоновки (ошибки неопределенной ссылки). Библиотеки могут быть дорогими проприетарными или труднодоступными по какой-либо другой причине. В этом случае получение статически скомпонованного бинарника либо от автора пакета, либо из группы пользователей Linux может быть самым простым решением.

- Запуск скрипта `configure` создает странный `Makefile`, который, казалось бы, не связан с пакетом, который вы пытаетесь собрать. Это означает, что был запущен неправильный `configure`, найденный где-то еще в вашем `PATH`. Всегда вызывайте `configure` как `./configure`, чтобы предотвратить это.

- Большинство дистрибутивов Linux перешли с библиотек `libc 5` на `libc 6 / glibc 2. `Предварительно скомпилированные бинарники, которые работали со старой библиотекой, могут "падать", если вы обновили библиотеку. Решение заключается в перекомпиляции приложений из исходников или получении более новых предварительно скомпилированных бинарников. Если вы находитесь в процессе обновления системы до `libc 6 `и испытываете проблемы, обратитесь к HOWTO по `glibc 2 `Эрика Грина.

>    *Обратите внимание, что между версиями `glibc` есть некоторые незначительные несовместимости, поэтому бинарник, собранный с `glibc 2.1`, может не работать с `glibc 2.0`, и наоборот.*

- Иногда необходимо удалить опцию `-ansi` из флагов компиляции в `Makefile`. Это включает дополнительные, не-ANSI функции `gcc` и позволяет собирать пакеты, которые требуют этих расширений. (Спасибо Sebastien Blondeel за указание на это.)

- Некоторые программы требуют установки бита `setuid` root, чтобы запускаться с привилегиями root. Команда для этого — `chmod u+s filename`, выполняемая от имени root (обратите внимание, что программа уже должна принадлежать root). Это устанавливает бит `setuid` в правах доступа к файлу. Эта проблема возникает, когда программа обращается к системному оборудованию, такому как модем или CD-ROM, или когда библиотеки `SVGA` вызываются из консольного режима, как в одном особенно печально известном пакете эмуляции. Если программа работает при запуске от root, но выдает сообщения об ошибке доступа для обычного пользователя, подозревайте в этом причину.

>    ***Предупреждение:** Программа с `setuid` root может представлять угрозу безопасности вашей системы. Программа запускается с привилегиями root и, следовательно, потенциально может нанести значительный ущерб. Прежде чем устанавливать бит `setuid`, убедитесь, что вы знаете, что делает программа, по возможности просмотрев исходный код.*

## 7.3 Настройка и точная подгонка (Tweaking and fine tuning)

Вы можете изучить `Makefile`, чтобы убедиться, что для вашей системы используются наилучшие параметры компиляции. Например, установка флага `-O2` выбирает наивысший уровень оптимизации, а флаг `-fomit-frame-pointer` приводит к уменьшению размера бинарного файла (хотя отладка тогда будет отключена). Не экспериментируйте с этим, если вы не знаете, что делаете, и в любом случае, только после того, как пробная сборка работает.

## 7.4 Где искать дополнительную помощь

По моему опыту, возможно, 25% приложений собираются "из коробки". Еще около 50% можно "убедить" собраться с усилием, варьирующимся от тривиального до геркулесова. Это все еще означает, что значительное количество пакетов не будет собираться, что бы вы ни делали. Но даже тогда, бинарники для `Intel ELF` и/или `a.out `для них, возможно, можно найти на Sunsite или в архиве` TSX-11`. У Red Hat и Debian есть обширные архивы предварительно упакованных бинарников для большинства популярного программного обеспечения Linux. Возможно, автор программного обеспечения может поставить бинарники, скомпилированные для вашего конкретного типа машины.

Обратите внимание, что если вы получаете предварительно скомпилированные бинарники, вам нужно проверить их совместимость с вашей системой:

- Бинарники должны работать на вашем оборудовании (т.е. Intel x86).

- Бинарники должны быть совместимы с вашим ядром (т.е. a.out или ELF).

- Ваши библиотеки должны быть актуальными.

- Ваша система должна иметь соответствующую утилиту установки (rpm или deb).

Если все остальное не помогает, вы можете найти помощь в соответствующих телеконференциях, таких как `comp.os.linux.x` или `comp.os.linux.development`.

Если ничего не работает, по крайней мере, вы приложили все усилия и многому научились.

---
[[Навигация по книге «Building and Installing Software Packages for Linux»]]


### Зачем вам это нужно? Развёрнутые пояснения

Эта глава — возможно, самая важная в руководстве. Она не просто перечисляет ошибки, а **учит методологии решения проблем**, что критически важно для успешного прохождения LFS.

**1. Методология отладки.**  
Автор показывает системный подход к решению проблем:

1. **Чтение сообщений об ошибках:** Первый шаг — понять, что говорит ошибка. Например, "undefined reference to `cos'" сразу указывает на отсутствие математической библиотеки.

2. **Проверка конфигурации:** Смотреть на `Makefile`, проверять пути к библиотекам (`-L`, `-I`).

3. **Поиск недостающих компонентов:** Знать, где искать библиотеки (`/usr/X11R6/lib`, `/usr/lib`).

4. **Создание символических ссылок:** Частое решение проблем с версиями библиотек.

5. **Использование альтернативных команд:** Например, `ldconfig` для обновления кэша библиотек.


**2. Типичные ошибки и их решения:**

- **Ошибки компоновки:** Чаще всего связаны с отсутствием библиотек или неправильными путями. Решения: добавление путей в `Makefile`, создание символических ссылок, установка недостающих пакетов.

- **Ошибки зависимостей:** Несоответствие версий библиотек. Решения: обновление библиотек, создание ссылок на совместимые версии, использование статических бинарников.

- **Ошибки в скриптах:** Неправильный путь к интерпретатору в shebang (`#!/usr/bin/perl`). Решения: изменение скрипта или создание символических ссылок.

**3. Работа с устаревшими библиотеками (`X11R5`, `libc5`).**  
Исторический контекст: переход с `X11R5` на `X11R6`, с `libc5` на `glibc2`. В LFS вы будете использовать современные библиотеки, но понимание проблем совместимости полезно для работы со старым ПО.

**4. Безопасность и `setuid`.**  
Важное предупреждение: программы с `setuid` root — это риск. В LFS вы будете аккуратно настраивать права доступа для некоторых программ (например, `passwd`, `sudo`). Понимание рисков необходимо.

**5. Оптимизация (`-O2`, `-fomit-frame-pointer`).**  
В LFS для каждого пакета указаны оптимальные флаги компиляции. Не меняйте их без необходимости, так как это может нарушить стабильность системы. Но знание этих флагов полезно для тонкой настройки после LFS.

**6. Поиск помощи.**  
Автор дает реалистичную оценку: 25% пакетов собираются сразу, 50% — с небольшими усилиями, 25% — могут не собраться. В LFS все пакеты из книги точно собираются, но вы можете столкнуться с проблемами при добавлении дополнительного ПО. Знание источников помощи (архивы, форумы, HOWTO) критически важно.


**Как это применимо к LFS:**

1. **Анализ ошибок:** В процессе сборки LFS что-то может пойти не так. Умение читать сообщения об ошибках и находить решение — ключевой навык.

2. **Работа с зависимостями:** В LFS пакеты собираются в строгом порядке, чтобы удовлетворять зависимости. Если вы нарушите порядок, возникнут ошибки компоновки.

3. **Использование символических ссылок:** В LFS вы будете часто создавать символические ссылки для библиотек и заголовочных файлов (например, `libgmp.so -> libgmp.so.10`).

4. **Проверка путей:** Убедиться, что компилятор ищет библиотеки и заголовочные файлы в правильных местах (в LFS это `/tools` или `/usr`).

5. **Безопасность:** После сборки LFS нужно правильно настроить права доступа для системных программ.

**Практические советы перед LFS:**

1. Потренируйтесь в решении проблем: соберите несколько пакетов из исходников и намеренно создайте ошибки (например, удалите библиотеку, измените путь в `Makefile`), а затем исправьте их.
    
2. Изучите утилиты для диагностики:

    - `ldd` — показывает зависимости библиотек.
    
    - `nm` — показывает символы в объектных файлах и библиотеках.
    
    - `readelf` — анализирует ELF-файлы.
    
    - `objdump` — дизассемблирует и анализирует объектные файлы.

3. Научитесь читать `Makefile` и понимать основные переменные `(CC, CFLAGS, LDFLAGS, LIBS)`.

Эта глава учит самому важному — **умению решать проблемы**. Сборка LFS — это не просто выполнение инструкций, а процесс, в котором могут возникать непредвиденные трудности. Навыки диагностики и отладки, полученные из этой главы, помогут вам преодолеть эти трудности и успешно завершить LFS. Помните: каждая решенная проблема делает вас более опытным системным администратором.